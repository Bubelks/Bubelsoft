///<amd-module name="app"/>
define("app", ["require", "exports", "home/home", "logIn/logIn", "company/companyApp", "buildings/buildingsApp", "user/userApp", "utils/router", "knockout", "utils/navigator"], function (require, exports, home_1, logIn_1, companyApp_1, buildingsApp_1, userApp_1, router_1, ko, navigator) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var App = (function () {
        function App() {
            var _this = this;
            this.goTo = function (url) {
                navigator.navigate(url);
            };
            this.home = ko.observable(null);
            this.logIn = ko.observable(null);
            this.useBuildingsApp = ko.observable(false);
            this.useCompanyApp = ko.observable(false);
            this.useUserApp = ko.observable(false);
            this.buildingsApp = new buildingsApp_1.BuildingsApp();
            this.companyApp = new companyApp_1.CompanyApp();
            this.userApp = new userApp_1.UserApp();
            this.router = new router_1.Router(this.createRouterOptions());
            this.router.add("home", function () { return _this.showHome(); });
            this.router.add("logIn", function () { return _this.showLogIn(); });
            this.router.add("company", function () { return _this.showCompany(); });
            this.router.add("buildings", function () { return _this.showBuildings(); });
            this.router.add("user", function () { return _this.showUser(); });
            this.router.start();
        }
        App.prototype.unauthorize = function () {
            navigator.navigate("logIn");
        };
        App.prototype.authorize = function () {
            navigator.navigate("home");
        };
        App.prototype.openUserMenu = function () {
            $("nav .dropdown .user-avatar").toggleClass("show");
            $("nav .dropdown .dropdown-menu").toggleClass("show");
        };
        App.prototype.logOut = function () {
            document.cookie = "bubelsoftToken=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            navigator.navigate("logIn");
        };
        App.prototype.showCompany = function () {
            this.hideAll();
            this.useCompanyApp(true);
        };
        App.prototype.showBuildings = function () {
            this.hideAll();
            this.useBuildingsApp(true);
        };
        App.prototype.showUser = function () {
            this.hideAll();
            this.useUserApp(true);
        };
        App.prototype.showHome = function () {
            this.hideAll();
            this.home(new home_1.Home());
        };
        App.prototype.showLogIn = function () {
            var _this = this;
            this.hideAll();
            this.logIn(new logIn_1.LogIn(function () { return _this.authorize(); }));
        };
        App.prototype.hideAll = function () {
            if (this.logIn() !== null) {
                this.logIn().dispose();
                this.logIn(null);
            }
            if (this.home() !== null) {
                this.home().dispose();
                this.home(null);
            }
            this.useCompanyApp(false);
            this.useBuildingsApp(false);
            this.useUserApp(false);
        };
        App.prototype.createRouterOptions = function () {
            return {
                mode: router_1.RouterMode.Hash,
                root: window.location.host
            };
        };
        return App;
    }());
    App.apiUrl = "http://localhost:5000/api";
    exports.App = App;
    var AppSingleton = (function () {
        function AppSingleton() {
        }
        AppSingleton.setInstance = function (app) {
            this.instance = app;
        };
        AppSingleton.getInstance = function () {
            return this.instance;
        };
        return AppSingleton;
    }());
    exports.AppSingleton = AppSingleton;
});
//# sourceMappingURL=app.js.map
///<amd-module name="buildings/buildingsApp"/>
define("buildings/buildingsApp", ["require", "exports", "utils/router", "buildings/create/create", "buildings/list/list ", "buildings/building/building", "buildings/building/companies/subContractor/subContractor", "knockout"], function (require, exports, router_1, create_1, list_1, building_1, subContractor_1, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var BuildingsApp = (function () {
        function BuildingsApp() {
            var _this = this;
            this.create = ko.observable(null);
            this.buildingsList = ko.observable(null);
            this.building = ko.observable(null);
            this.subContractor = ko.observable(null);
            this.router = new router_1.Router(this.createRouterOptions());
            this.router.add("buildings/:buildingId/create", function (buildingId) { return _this.showCreate(buildingId); });
            this.router.add("buildings/:buildingId/subContractor", function (buildingId) { return _this.newSubContractor(buildingId); });
            this.router.add("buildings/:buildingId", function (buildingId) { return _this.showBuilding(buildingId); });
            this.router.add("buildings", function () { return _this.showList(); });
            this.router.start();
        }
        BuildingsApp.prototype.showList = function () {
            this.hideAll();
            this.buildingsList(new list_1.BuildingsList());
        };
        BuildingsApp.prototype.showCreate = function (buildingId) {
            this.hideAll();
            this.create(new create_1.Create(buildingId));
        };
        BuildingsApp.prototype.showBuilding = function (buildingId) {
            this.hideAll();
            this.building(new building_1.Building(buildingId));
        };
        BuildingsApp.prototype.newSubContractor = function (buildingId) {
            this.hideAll();
            this.subContractor(new subContractor_1.SubContractor(buildingId));
        };
        BuildingsApp.prototype.createRouterOptions = function () {
            return {
                mode: router_1.RouterMode.History,
                root: window.location.host
            };
        };
        BuildingsApp.prototype.hideAll = function () {
            if (this.create() != null)
                this.create().dispose();
            this.create(null);
            if (this.building() != null)
                this.building().dispose();
            this.building(null);
            if (this.buildingsList() != null)
                this.buildingsList().dispose();
            this.buildingsList(null);
            if (this.subContractor() != null)
                this.subContractor().dispose();
            this.subContractor(null);
        };
        BuildingsApp.prototype.dispose = function () {
        };
        return BuildingsApp;
    }());
    exports.BuildingsApp = BuildingsApp;
});
//# sourceMappingURL=buildingsApp.js.map
///<amd-module name="company/company"/>
define("company/company", ["require", "exports", "utils/communication/rest", "knockout"], function (require, exports, rest, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Company = (function () {
        function Company(id) {
            var _this = this;
            this.toDelete = function (user, event) {
                var index = _this.userToDelete.indexOf(user.id);
                if (index >= 0)
                    _this.userToDelete.splice(index, 1);
                else
                    _this.userToDelete.push(user.id);
                $(event.currentTarget).toggleClass("selected");
            };
            this.companyInfo = ko.observable(null);
            this.companyInfoEdit = ko.observable(null);
            this.workers = ko.observableArray([]);
            this.userEdit = ko.observable(null);
            this.userToDelete = new Array();
            this.canManageWorkers = ko.observable(false);
            this.avaiableRoles = [
                {
                    value: UserCompanyRole.Admin,
                    displayValue: UserCompanyRolePresenter.getDisplayValue(UserCompanyRole.Admin)
                },
                {
                    value: UserCompanyRole.UserAdmin,
                    displayValue: UserCompanyRolePresenter.getDisplayValue(UserCompanyRole.UserAdmin)
                },
                {
                    value: UserCompanyRole.Worker,
                    displayValue: UserCompanyRolePresenter.getDisplayValue(UserCompanyRole.Worker)
                }
            ];
            this.companyRequest(id)
                .done(function (data) {
                _this.companyInfo(data);
                _this.companyInfoEdit(_this.companyInfo());
                data.workers.forEach(function (w) { return w.companyRole = UserCompanyRolePresenter.getDisplayValue(w.companyRole); });
                _this.workers(data.workers);
                _this.canManageWorkers(data.canManageWorkers);
            });
        }
        Company.prototype.companyRequest = function (id) {
            if (id !== null)
                return rest.get("company", "" + id);
            else
                return rest.get("company", "my");
        };
        Company.prototype.saveInfo = function () {
            var _this = this;
            rest.put("company", "" + this.companyInfo().id, this.companyInfoEdit())
                .done(function () {
                _this.companyInfo(_this.companyInfoEdit());
            })
                .fail(function () { return _this.companyInfoEdit(_this.companyInfo()); });
        };
        Company.prototype.saveUser = function () {
            var _this = this;
            var companyRole = this.userEdit().companyRole.value;
            this.userEdit().companyRole = companyRole;
            rest.put("company", this.companyInfo().id + "/workers/add", this.userEdit())
                .done(function () { return _this.workers.push(_this.userEdit()); });
        };
        Company.prototype.confirmDelete = function () {
            var _this = this;
            rest.put("company", this.companyInfo().id + "/workers/delete", this.userToDelete)
                .done(function () {
                return _this.userToDelete.forEach(function (id) { return _this.workers.remove(function (w) { return w.id == id; }); });
            })
                .fail(function () { return _this.cancelDelete(); });
        };
        Company.prototype.cancelDelete = function () {
            this.userToDelete = new Array();
            $("#delete-worker").removeClass("selected");
        };
        Company.prototype.openAddUser = function () {
            this.userEdit({
                id: 0,
                username: null,
                firstName: null,
                lastName: null,
                phoneNumber: null,
                email: null,
                companyRole: this.avaiableRoles.filter(function (r) { return r.value === UserCompanyRole.Worker; })[0],
                forRegister: false
            });
        };
        Company.prototype.dispose = function () {
        };
        return Company;
    }());
    exports.Company = Company;
    var UserCompanyRolePresenter = (function () {
        function UserCompanyRolePresenter() {
        }
        UserCompanyRolePresenter.getDisplayValue = function (role) {
            switch (role) {
                case UserCompanyRole.Admin:
                    return "Administrator";
                case UserCompanyRole.UserAdmin:
                    return "User Administrator";
                default:
                    return "Worker";
            }
        };
        return UserCompanyRolePresenter;
    }());
});
//# sourceMappingURL=company.js.map
///<amd-module name="company/companyApp"/>
define("company/companyApp", ["require", "exports", "utils/router", "company/company", "knockout"], function (require, exports, router_1, company_1, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var CompanyApp = (function () {
        function CompanyApp() {
            var _this = this;
            this.company = ko.observable(null);
            this.router = new router_1.Router(this.createRouterOptions());
            this.router.add("company/:companyId", function (companyId) { return _this.showCompany(companyId); });
            this.router.add("company", function () { return _this.showCompany(null); });
            this.router.start();
        }
        CompanyApp.prototype.showCompany = function (companyId) {
            this.company(new company_1.Company(companyId));
        };
        CompanyApp.prototype.createRouterOptions = function () {
            return {
                mode: router_1.RouterMode.History,
                root: window.location.host
            };
        };
        return CompanyApp;
    }());
    exports.CompanyApp = CompanyApp;
});
//# sourceMappingURL=companyApp.js.map
var UserCompanyRole;
(function (UserCompanyRole) {
    UserCompanyRole[UserCompanyRole["Admin"] = 0] = "Admin";
    UserCompanyRole[UserCompanyRole["UserAdmin"] = 1] = "UserAdmin";
    UserCompanyRole[UserCompanyRole["Worker"] = 2] = "Worker";
})(UserCompanyRole || (UserCompanyRole = {}));
var UserBuildingRole;
(function (UserBuildingRole) {
    UserBuildingRole[UserBuildingRole["Admin"] = 0] = "Admin";
    UserBuildingRole[UserBuildingRole["Reporter"] = 1] = "Reporter";
})(UserBuildingRole || (UserBuildingRole = {}));
//# sourceMappingURL=interfaces.js.map
///<amd-module name="home/home"/>
define("home/home", ["require", "exports", "home/buildings/buildings", "home/notifications/notifications", "utils/communication/rest", "knockout"], function (require, exports, buildings_1, notifications_1, rest, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Home = (function () {
        function Home() {
            var _this = this;
            this.buildings = ko.observable(new buildings_1.Buildings([], null));
            this.notifications = ko.observable(new notifications_1.Notifications([]));
            this.getBuildings()
                .then(function (buildings) {
                _this.notifications(new notifications_1.Notifications(buildings.map(function (b) { return b.name; })));
                _this.buildings(new buildings_1.Buildings(buildings, _this.notifications().showFor));
            });
        }
        Home.prototype.getBuildings = function () {
            return rest.get("buildings", "");
        };
        Home.prototype.dispose = function () {
            if (this.buildings())
                this.buildings().dispose();
            if (this.notifications())
                this.notifications().dispose();
        };
        return Home;
    }());
    exports.Home = Home;
});
//# sourceMappingURL=home.js.map
///<amd-module name="logIn/logIn"/>
define("logIn/logIn", ["require", "exports", "knockout", "utils/communication/rest"], function (require, exports, ko, rest) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var LogIn = (function () {
        function LogIn(onLogIn) {
            var _this = this;
            this.validate = function () { return _this.userName().length !== 0 && _this.password().length !== 0; };
            this.userName = ko.observable("");
            this.password = ko.observable("");
            this.invalid = ko.observable(false);
            this.loading = ko.observable(false);
            this.onLogIn = onLogIn;
        }
        LogIn.prototype.logIn = function () {
            var _this = this;
            this.loading(true);
            if (!this.validate())
                this.invalid(true);
            else
                rest.post("user", "logIn", { userName: this.userName(), password: this.password() })
                    .done(function (data) {
                    _this.setCookies(data);
                    _this.onLogIn();
                    _this.invalid(false);
                })
                    .fail(function () { return _this.invalid(true); });
            this.loading(false);
            document.getElementsByTagName("login")[0].getElementsByTagName("button")[0].blur();
        };
        LogIn.prototype.dispose = function () { };
        LogIn.prototype.setCookies = function (data) {
            document.cookie = "bubelsoftToken=" + data.token + "; expires=" + data.expiration + "; path=/";
        };
        return LogIn;
    }());
    exports.LogIn = LogIn;
});
//# sourceMappingURL=logIn.js.map
///<amd-module name="user/userApp"/>
define("user/userApp", ["require", "exports", "utils/router", "user/register/register", "knockout"], function (require, exports, router_1, register_1, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var UserApp = (function () {
        function UserApp() {
            var _this = this;
            this.registerUser = ko.observable(null);
            this.router = new router_1.Router(this.createRouterOptions());
            this.router.add("user/register/:userId", function (userId) { return _this.showRegister(userId); });
            this.router.start();
        }
        UserApp.prototype.showRegister = function (userId) {
            this.registerUser(new register_1.RegisterUser(userId));
        };
        UserApp.prototype.createRouterOptions = function () {
            return {
                mode: router_1.RouterMode.History,
                root: window.location.host
            };
        };
        return UserApp;
    }());
    exports.UserApp = UserApp;
});
//# sourceMappingURL=userApp.js.map
///<amd-module name="utils/navigator"/>
define("utils/navigator", ["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    function navigate(path) {
        window.location.href = window.location.href.replace(/#(.*)$/, "") + "#" + path;
    }
    exports.navigate = navigate;
});
//# sourceMappingURL=navigator.js.map
///<amd-module name="utils/router"/>
define("utils/router", ["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Router = (function () {
        function Router(options) {
            var _this = this;
            this.root = "/";
            this.start = function () {
                var current = _this.root;
                var fn = function () {
                    if (current !== _this.getFragment()) {
                        current = _this.getFragment();
                        _this.check(current);
                    }
                };
                clearInterval(_this.listener);
                _this.listener = setInterval(fn, 50);
            };
            this.mode = options && options.mode && options.mode === RouterMode.History && !!(history.pushState)
                ? RouterMode.History
                : RouterMode.Hash;
            this.root = options && options.root ? "/" + this.clearSlashes(options.root) + "/" : "/";
            this.routes = new Array();
        }
        Router.prototype.add = function (route, handler) {
            this.routes.push({ route: route, handler: handler });
            return this;
        };
        Router.prototype.remove = function (route) {
            var _this = this;
            this.routes.forEach(function (r, i) {
                if (r.route === route) {
                    _this.routes.splice(i, 1);
                }
            });
            return this;
        };
        Router.prototype.check = function (fragment) {
            if (fragment === null || typeof fragment === "undefined")
                fragment = this.getFragment();
            for (var i = 0; i < this.routes.length; i++) {
                var variableNames = [];
                var route = this.routes[i].route.replace(/([:*])(\w+)/g, function (full, dots, name) {
                    variableNames.push(name);
                    return "([^\/]+)";
                }) + "(?:\/|$)";
                var match = fragment.match(new RegExp(route));
                if (match) {
                    match.shift();
                    this.routes[i].handler.apply({}, match);
                    return;
                }
            }
        };
        Router.prototype.getFragment = function () {
            var fragment;
            if (this.mode === RouterMode.History) {
                var match = window.location.href.match(/#(.*)$/);
                fragment = match ? match[1] : "";
            }
            else {
                var match = window.location.href.match(/#(.*)$/);
                fragment = match ? match[1].split("/")[0] : "";
            }
            return this.clearSlashes(fragment);
        };
        Router.prototype.clearSlashes = function (path) {
            return path.toString().replace(/\/$/, "").replace(/^\//, "");
        };
        return Router;
    }());
    exports.Router = Router;
    var RouterMode;
    (function (RouterMode) {
        RouterMode[RouterMode["Hash"] = 0] = "Hash";
        RouterMode[RouterMode["History"] = 1] = "History";
    })(RouterMode = exports.RouterMode || (exports.RouterMode = {}));
});
//# sourceMappingURL=router.js.map
///<amd-module name="buildings/building/building"/>
define("buildings/building/building", ["require", "exports", "buildings/building/companies/companies", "buildings/building/calendar/calendar", "buildings/building/estimation/estimation", "buildings/building/report/report", "buildings/building/reports/reports", "knockout", "utils/communication/rest"], function (require, exports, companies_1, calendar_1, estimation_1, report_1, reports_1, ko, rest) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Building = (function () {
        function Building(buildingId) {
            var _this = this;
            this.toggleCard = function (clicked, _, event) {
                if (clicked === "calendar" && _this.useCalendar())
                    return;
                if (clicked === "estimation" && _this.useEstimation())
                    return;
                if (clicked === "reports" && _this.useReports())
                    return;
                $(event.currentTarget).blur();
                _this.useCalendar(false);
                _this.useEstimation(false);
                _this.useReports(false);
                switch (clicked) {
                    case "calendar":
                        _this.useCalendar(true);
                        break;
                    case "estimation":
                        _this.useEstimation(true);
                        break;
                    case "reports":
                        _this.useReports(true);
                        break;
                }
            };
            this.id = buildingId;
            this.useCalendar = ko.observable(true);
            this.useEstimation = ko.observable(false);
            this.calendar = ko.observable(new calendar_1.Calendar(this.id));
            this.estimation = ko.observable(null);
            this.companies = ko.observable(null);
            this.buildingName = ko.observable("");
            this.canReport = ko.observable(false);
            this.useReports = ko.observable(false);
            this.newReport = ko.observable(null);
            this.reports = ko.observable(new reports_1.Reports(buildingId));
            this.getBuilding(buildingId)
                .done(function (data) {
                _this.buildingName(data.name);
                _this.canReport(data.canReport);
            });
            this.getCompanies(buildingId)
                .done(function (data) {
                _this.companies(new companies_1.Companies(data, _this.id));
                _this.estimation(new estimation_1.Estimation(buildingId, data));
            });
        }
        Building.prototype.openAddReport = function () {
            this.newReport(new report_1.Report(this.id));
        };
        Building.prototype.addReport = function () {
            var dto = this.newReport().getDto();
            rest.put("building", this.id + "/report", dto);
        };
        Building.prototype.getCompanies = function (buildingId) {
            return rest.get("building", buildingId + "/companies");
        };
        Building.prototype.getBuilding = function (buildingId) {
            return rest.get("building", "" + buildingId);
        };
        Building.prototype.dispose = function () {
        };
        return Building;
    }());
    exports.Building = Building;
});
//# sourceMappingURL=building.js.map
///<amd-module name="buildings/create/create"/>
define("buildings/create/create", ["require", "exports", "buildings/create/steps/estimate", "buildings/create/steps/building", "buildings/create/steps/company", "utils/communication/rest", "knockout", "utils/navigator"], function (require, exports, estimate_1, building_1, company_1, rest, ko, navigator) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Create = (function () {
        function Create(buildingId) {
            var _this = this;
            this.currentStep = ko.observable(null);
            this.buildingId = buildingId;
            this.getBuilding().done(function (data) {
                _this.buildingStep = new building_1.BuildingStep(data.name);
                _this.estimateStep = new estimate_1.EstimateStep(_this.buildingStep);
                _this.companyStep = new company_1.CompanyStep(_this.buildingStep, data.company);
                _this.buildingStep.setNext(_this.estimateStep);
                _this.buildingStep.setBack(_this.companyStep);
                _this.currentStep(_this.companyStep);
                _this.currentStep().activate(true);
            });
        }
        Create.prototype.next = function () {
            //if (!this.currentStep().valid()) return;
            var nextStep = this.currentStep().next();
            if (nextStep !== null)
                this.changeStep(nextStep);
            else
                this.save();
        };
        Create.prototype.back = function () {
            var backStep = this.currentStep().back();
            if (backStep !== null)
                this.changeStep(backStep);
        };
        Create.prototype.cancel = function () {
            navigator.navigate("home");
        };
        Create.prototype.save = function () {
            var _this = this;
            if (!this.estimateStep.valid())
                return;
            var building = {
                name: this.buildingStep.name(),
                company: this.companyStep.getDto()
            };
            rest.formPost("building", this.buildingId + "/estimation", this.estimateStep.getDto());
            rest.put("building", "" + this.buildingId, building)
                .done(function () { return navigator.navigate("buildings/" + _this.buildingId); });
        };
        Create.prototype.getBuilding = function () {
            return rest.get("buildings", "" + this.buildingId);
        };
        Create.prototype.changeStep = function (newStep) {
            this.currentStep().activate(false);
            this.currentStep(newStep);
            this.currentStep().activate(true);
        };
        Create.prototype.dispose = function () {
        };
        return Create;
    }());
    exports.Create = Create;
    var Step;
    (function (Step) {
        Step[Step["Company"] = 0] = "Company";
        Step[Step["Building"] = 1] = "Building";
        Step[Step["Estimate"] = 2] = "Estimate";
    })(Step || (Step = {}));
});
//# sourceMappingURL=create.js.map
///<amd-module name="buildings/list/list "/>
define("buildings/list/list ", ["require", "exports", "home/buildings/building", "utils/communication/rest", "knockout", "utils/navigator"], function (require, exports, building_1, rest, ko, navigator) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var BuildingsList = (function () {
        function BuildingsList() {
            var _this = this;
            this.mainContractBuildings = ko.observableArray([]);
            this.subContractBuildings = ko.observableArray([]);
            this.getBuildings().done(function (data) {
                _this.mainContractBuildings(data.filter(function (d) { return d.ownedByMy; }).map(function (d) { return new building_1.Building(d, function () { }); }));
                _this.subContractBuildings(data.filter(function (d) { return !d.ownedByMy; }).map(function (d) { return new building_1.Building(d, function () { }); }));
            });
        }
        BuildingsList.prototype.goToBuilding = function (building) {
            navigator.navigate("buildings/" + building.id);
        };
        BuildingsList.prototype.getBuildings = function () {
            return rest.get("buildings", "");
        };
        BuildingsList.prototype.dispose = function () {
        };
        return BuildingsList;
    }());
    exports.BuildingsList = BuildingsList;
});
//# sourceMappingURL=list.js.map
///<amd-module name="home/buildings/building"/>
define("home/buildings/building", ["require", "exports", "buildings/building/report/report", "utils/navigator", "utils/communication/rest", "knockout"], function (require, exports, report_1, navigator, rest, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Building = (function () {
        function Building(base, showNotifications) {
            this.buildingRolesMap = [
                {
                    key: UserBuildingRole.Admin,
                    value: "Administrator"
                },
                {
                    key: UserBuildingRole.Reporter,
                    value: "Reporter"
                }
            ];
            this.id = base.id;
            this.name = base.name;
            this.ownedByMy = base.ownedByMy;
            this.companyName = base.companyName;
            this.companyId = base.companyId;
            this.showNotifications = showNotifications;
            this.canReport = base.userBuildingRoles.filter(function (r) { return r === UserBuildingRole.Reporter; }).length > 0;
            this.rolesString = this.getRolesString(base.userBuildingRoles);
            this.newReport = ko.observable(null);
        }
        Building.prototype.icon = function () {
            if (this.ownedByMy)
                return "fa-circle";
            return "fa-circle-o";
        };
        Building.prototype.contractType = function () {
            if (this.ownedByMy)
                return "Main-Contract";
            return "Sub-Contract";
        };
        Building.prototype.goToCompany = function () {
            navigator.navigate("company/" + this.companyId);
        };
        Building.prototype.goToBuilding = function (_, event) {
            if ($(event.target).hasClass("company-name"))
                return;
            if ($(event.target).hasClass("grid-button"))
                return;
            if ($(event.target).hasClass("fa"))
                return;
            navigator.navigate("buildings/" + this.id);
        };
        Building.prototype.openAddReport = function () {
            this.newReport(new report_1.Report(this.id));
        };
        Building.prototype.addReport = function () {
            var dto = this.newReport().getDto();
            rest.put("building", this.id + "/report", dto);
        };
        Building.prototype.getRolesString = function (roles) {
            var result = this.buildingRolesMap.filter(function (r) { return r.key === roles[0]; })[0].value;
            for (var i = 1; i < roles.length; i++)
                result += ", " + this.buildingRolesMap.filter(function (r) { return r.key === roles[i]; })[0].value;
            return result;
        };
        return Building;
    }());
    exports.Building = Building;
});
//# sourceMappingURL=building.js.map
///<amd-module name="home/buildings/buildings"/>
define("home/buildings/buildings", ["require", "exports", "home/buildings/building", "knockout"], function (require, exports, building_1, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Buildings = (function () {
        function Buildings(buildings, showNotifications) {
            var _this = this;
            this.buildings = buildings.map(function (b) { return new building_1.Building(b, showNotifications); });
            this.contractTypes = ko.observableArray([
                { type: ContractType.All, displayName: "All" },
                { type: ContractType.SubContract, displayName: "Sub-Contract" },
                { type: ContractType.MainContract, displayName: "Main-contract" }
            ]);
            this.selectedType = ko.observable(this.contractTypes()[0]);
            this.visibleBuilding = ko.computed(function () {
                switch (_this.selectedType().type) {
                    case ContractType.SubContract:
                        return _this.buildings.filter(function (b) { return !b.ownedByMy; });
                    case ContractType.MainContract:
                        return _this.buildings.filter(function (b) { return b.ownedByMy; });
                    default:
                        return _this.buildings;
                }
            });
        }
        Buildings.prototype.dispose = function () {
        };
        return Buildings;
    }());
    exports.Buildings = Buildings;
    var ContractType;
    (function (ContractType) {
        ContractType[ContractType["All"] = 0] = "All";
        ContractType[ContractType["SubContract"] = 1] = "SubContract";
        ContractType[ContractType["MainContract"] = 2] = "MainContract";
    })(ContractType || (ContractType = {}));
});
//# sourceMappingURL=buildings.js.map
///<amd-module name="home/notifications/notifications"/>
define("home/notifications/notifications", ["require", "exports", "knockout"], function (require, exports, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Notifications = (function () {
        function Notifications(buildingNames) {
            var _this = this;
            this.showFor = function (buildingName) {
                _this.selectedBuildingName(buildingName);
                _this.selectedType(_this.notificationTypes().filter(function (n) { return n.type === NotificationType.Building; })[0]);
                _this.specifyBuilding(true);
            };
            this.allNotifcations = ko.observableArray([
                { name: "Notification1", source: "Building 1", content: "KOCHAM DOMiNKIĘ BARDZO BARDZO <3", isNew: true, type: NotificationType.Building },
                { name: "Notification2", source: "Company 1", content: "KOCHAM DOMiNKIĘ BARDZO BARDZO <3 x22222", isNew: false, type: NotificationType.Company }
            ]);
            this.notificationTypes = ko.observableArray([
                { type: NotificationType.All, displayName: "All" },
                { type: NotificationType.Building, displayName: "Building" },
                { type: NotificationType.Company, displayName: "Company" }
            ]);
            this.selectedType = ko.observable(this.notificationTypes()[0]);
            this.buildingNames = ko.observableArray(buildingNames);
            this.selectedBuildingName = ko.observable("");
            this.buildingsNamesVisible = ko.computed(function () { return _this.selectedType().type === NotificationType.Building; });
            this.specifyBuilding = ko.observable(false);
            this.newNotificationsCount = ko.observable(this.allNotifcations().filter(function (n) { return n.isNew; }).length);
            this.visibleNotifications = ko.computed(function () {
                switch (_this.selectedType().type) {
                    case NotificationType.Building:
                        return _this.allNotifcations()
                            .filter(function (n) {
                            return n.type === NotificationType.Building &&
                                (!_this.specifyBuilding() || _this.selectedBuildingName() === n.source);
                        });
                    case NotificationType.Company:
                        return _this.allNotifcations().filter(function (n) { return n.type === NotificationType.Company; });
                    default:
                        return _this.allNotifcations();
                }
            });
        }
        Notifications.prototype.toggleSpecifyBuilding = function () {
            this.specifyBuilding(!this.specifyBuilding());
        };
        Notifications.prototype.dispose = function () {
            this.visibleNotifications.dispose();
            this.buildingsNamesVisible.dispose();
        };
        return Notifications;
    }());
    exports.Notifications = Notifications;
    var NotificationType;
    (function (NotificationType) {
        NotificationType[NotificationType["All"] = 0] = "All";
        NotificationType[NotificationType["Building"] = 1] = "Building";
        NotificationType[NotificationType["Company"] = 2] = "Company";
    })(NotificationType || (NotificationType = {}));
});
//# sourceMappingURL=notifications.js.map
///<amd-module name="user/register/register"/>
define("user/register/register", ["require", "exports", "utils/communication/rest", "knockout", "utils/navigator"], function (require, exports, rest, ko, navigator) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var RegisterUser = (function () {
        function RegisterUser(userId) {
            var _this = this;
            this.user = ko.observable(null);
            this.modalOpen = ko.observable(false);
            this.getUser(userId)
                .done(function (data) {
                _this.user(data);
                _this.user().forRegister = true;
                _this.user().password = "";
                _this.user().id = userId;
                _this.openModal();
            });
        }
        RegisterUser.prototype.saveUser = function () {
            var _this = this;
            rest.post("user", "register", this.user())
                .done(function () {
                _this.closeModal();
                navigator.navigate("home");
            });
        };
        RegisterUser.prototype.getUser = function (userId) {
            return rest.get("user", "" + userId);
        };
        RegisterUser.prototype.closeModal = function () {
            this.modalOpen(false);
            $("body").removeClass("modal-open");
            var modal = $("#registerModal");
            modal.removeClass("show");
            modal.css("display", "none");
        };
        RegisterUser.prototype.openModal = function () {
            this.modalOpen(true);
            $("body").addClass("modal-open");
        };
        return RegisterUser;
    }());
    exports.RegisterUser = RegisterUser;
});
//# sourceMappingURL=register.js.map
///<amd-module name="utils/communication/rest"/>
define("utils/communication/rest", ["require", "exports", "jquery", "app"], function (require, exports, $, app_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    function get(controller, action) {
        var url = app_1.App.apiUrl + "/" + controller + "/" + action;
        return $.ajax({
            headers: {
                "Authorization": "bearer " + readToken()
            },
            url: url
        }).always(function (xhr) {
            if (xhr.status === 401)
                app_1.AppSingleton.getInstance().unauthorize();
        });
        ;
    }
    exports.get = get;
    function post(controller, action, body) {
        var url = app_1.App.apiUrl + "/" + controller + "/" + action;
        return $.ajax({
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(body),
            type: "POST",
            headers: {
                "authorization": "bearer " + readToken()
            },
            url: url
        }).always(function (xhr) {
            if (xhr.status === 401)
                app_1.AppSingleton.getInstance().unauthorize();
        });
    }
    exports.post = post;
    function formPost(controller, action, data) {
        var url = app_1.App.apiUrl + "/" + controller + "/" + action;
        return $.ajax({
            contentType: false,
            processData: false,
            data: data,
            type: "POST",
            headers: {
                "authorization": "bearer " + readToken()
            },
            url: url
        }).always(function (xhr) {
            if (xhr.status === 401)
                app_1.AppSingleton.getInstance().unauthorize();
        });
    }
    exports.formPost = formPost;
    function put(controller, action, body) {
        var url = app_1.App.apiUrl + "/" + controller + "/" + action;
        return $.ajax({
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(body),
            type: "PUT",
            headers: {
                "authorization": "bearer " + readToken()
            },
            url: url
        }).always(function (xhr) {
            if (xhr.status === 401)
                app_1.AppSingleton.getInstance().unauthorize();
        });
    }
    exports.put = put;
    function ping() {
        return get("buildings", "");
    }
    exports.ping = ping;
    function readToken() {
        var nameEQ = "bubelsoftToken=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ')
                c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0)
                return c.substring(nameEQ.length, c.length);
        }
        return null;
    }
});
//# sourceMappingURL=rest.js.map
///<amd-module name="buildings/building/calendar/calendar"/>
define("buildings/building/calendar/calendar", ["require", "exports", "buildings/building/report/report", "knockout", "utils/communication/rest"], function (require, exports, report_1, ko, rest) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Calendar = (function () {
        function Calendar(buildingId) {
            var _this = this;
            this.avaiableYears = [2017, 2018, 2019];
            this.avaiableMonths = [
                { value: 1, displayValue: "January" },
                { value: 2, displayValue: "February" },
                { value: 3, displayValue: "March" },
                { value: 4, displayValue: "April" },
                { value: 5, displayValue: "May" },
                { value: 6, displayValue: "June" },
                { value: 7, displayValue: "July" },
                { value: 8, displayValue: "August" },
                { value: 9, displayValue: "September" },
                { value: 10, displayValue: "October" },
                { value: 11, displayValue: "November" },
                { value: 12, displayValue: "December" }
            ];
            this.openModal = function (report) {
                _this.reportDetails(new report_1.Report(_this.buildingId, report.id));
                _this.modalOpen(true);
                $("body").addClass("modal-open");
                var modal = $("#reportDetails");
                modal.addClass("show");
                modal.css("display", "block");
            };
            this.closeModal = function () {
                _this.reportDetails(null);
                _this.modalOpen(false);
                $("body").removeClass("modal-open");
                var modal = $("#reportDetails");
                modal.removeClass("show");
                modal.css("display", "none");
            };
            this.refresh = function () {
                _this.getReports()
                    .done(function (data) {
                    return _this.reports(data.map(function (d) { return ({
                        day: d.day,
                        reports: d.reports,
                        openModal: _this.openModal
                    }); }));
                });
            };
            this.buildingId = buildingId;
            this.reportDetails = ko.observable(null);
            this.modalOpen = ko.observable(false);
            var currentDate = new Date(Date.now());
            this.year = ko.observable(currentDate.getFullYear());
            var month = this.avaiableMonths.filter(function (m) { return m.value === currentDate.getMonth() + 1; })[0];
            this.month = ko.observable(month);
            this.reports = ko.observableArray([]);
            this.yearSub = this.year.subscribe(function () { return _this.refresh(); });
            this.monthSub = this.month.subscribe(function () { return _this.refresh(); });
            this.refresh();
        }
        Calendar.prototype.saveReport = function () {
            var dto = this.reportDetails().getDto();
            rest.post("building", this.buildingId + "/report/" + this.reportDetails().reportId, dto);
        };
        Calendar.prototype.getReports = function () {
            return rest.post("building", this.buildingId + "/reports", { month: this.month().value, year: this.year() });
        };
        return Calendar;
    }());
    exports.Calendar = Calendar;
});
//# sourceMappingURL=calendar.js.map
///<amd-module name="buildings/building/companies/companies"/>
define("buildings/building/companies/companies", ["require", "exports", "utils/navigator", "knockout", "utils/communication/rest"], function (require, exports, navigator, ko, rest) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Companies = (function () {
        function Companies(companies, buildingId) {
            var _this = this;
            this.closeCompanies = function () {
                _this.mainContractor().isOpen(false);
                _this.subContractors().forEach(function (c) { return c.isOpen(false); });
            };
            this.buildingId = buildingId;
            this.avaiableCompanies = ko.observableArray([]);
            this.newCompany = ko.observable(null);
            this.newCompanyEmail = ko.observable(null);
            this.mainContractor = ko.observable(new BuildingCompany(companies.filter(function (d) { return d.mainContract; })[0], this.buildingId, this.closeCompanies));
            this.subContractors = ko.observableArray(companies.filter(function (d) { return !d.mainContract; }).map(function (d) { return new BuildingCompany(d, _this.buildingId, _this.closeCompanies); }));
        }
        Companies.prototype.addSubcontractor = function () {
            var _this = this;
            rest.get("company", "")
                .done(function (data) { return _this.avaiableCompanies(data.filter(function (d) { return d.value !== _this.mainContractor().id &&
                _this.subContractors().filter(function (sc) { return sc.id === d.value; }).length === 0; })); });
        };
        Companies.prototype.confirmAdding = function () {
            if (this.newCompanyEmail() !== null)
                rest.put("building", this.buildingId + "/companies/add", this.newCompanyEmail());
            else
                rest.post("building", this.buildingId + "/companies/add", this.newCompany().value);
        };
        Companies.prototype.dispose = function () {
        };
        return Companies;
    }());
    exports.Companies = Companies;
    var BuildingCompany = (function () {
        function BuildingCompany(base, buildingId, closeCompanies) {
            var _this = this;
            this.buildingRolesMap = [
                {
                    key: UserBuildingRole.Admin,
                    value: "Administrator"
                },
                {
                    key: UserBuildingRole.Reporter,
                    value: "Reporter"
                }
            ];
            this.toggleWorkers = function (company) {
                if (!company.isOpen()) {
                    _this.closeCompaies();
                }
                company.isOpen(!company.isOpen());
            };
            this.buildingId = buildingId;
            this.closeCompaies = closeCompanies;
            this.isOpen = ko.observable(false);
            this.id = base.id;
            this.name = base.name;
            this.workers = base.workers.map(function (w) {
                return {
                    userId: w.userId,
                    displayName: w.displayName,
                    userBuildingRoles: _this.getRolesString(w.userBuildingRoles)
                };
            });
            this.avaiableWorkers = ko.observableArray([]);
            this.newWorker = ko.observable(null);
            this.avaiableRoles = ko.observableArray(this.buildingRolesMap.map(function (rm) { return ({
                value: rm.key,
                displayValue: rm.value
            }); }));
            this.newWorker = ko.observable(this.avaiableRoles[0]);
            this.roles = ko.observable("");
            this.roleIds = new Array();
            this.addingRole = ko.observable(null);
        }
        BuildingCompany.prototype.addWorker = function () {
            var _this = this;
            rest.get("company", this.id + "/workers")
                .done(function (data) { return _this.avaiableWorkers(data.filter(function (d) { return _this.workers.filter(function (sc) { return sc.userId === d.value; }).length === 0; })); });
        };
        BuildingCompany.prototype.addRole = function () {
            if (this.roles() !== "")
                this.roles(this.roles() + ", ");
            this.roles(this.roles() + this.addingRole().displayValue);
            this.roleIds.push(this.addingRole().value);
            this.avaiableRoles.remove(this.addingRole());
            this.addingRole(null);
        };
        BuildingCompany.prototype.confirmAddWorker = function () {
            var _this = this;
            rest.post("building", this.buildingId + "/worker/add", {
                userId: this.newWorker().value,
                userBuildingRoles: this.roleIds
            }).
                done(function () {
                _this.avaiableWorkers([]);
                _this.newWorker(null);
                _this.avaiableRoles(_this.buildingRolesMap.map(function (rm) { return ({
                    value: rm.key,
                    displayValue: rm.value
                }); }));
                _this.newWorker(_this.avaiableRoles[0]);
                _this.roles("");
                _this.roleIds = new Array();
                _this.addingRole(null);
            });
        };
        BuildingCompany.prototype.goToCompany = function (company) {
            navigator.navigate("company/" + company.id);
        };
        BuildingCompany.prototype.getRolesString = function (roles) {
            var result = this.buildingRolesMap.filter(function (r) { return r.key === roles[0]; })[0].value;
            for (var i = 1; i < roles.length; i++)
                result += ", " + this.buildingRolesMap.filter(function (r) { return r.key === roles[i]; })[0].value;
            return result;
        };
        return BuildingCompany;
    }());
});
//# sourceMappingURL=companies.js.map
///<amd-module name="buildings/building/estimation/estimation"/>
define("buildings/building/estimation/estimation", ["require", "exports", "utils/communication/rest", "knockout"], function (require, exports, rest, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Estimation = (function () {
        function Estimation(buildingId, companies) {
            var _this = this;
            this.openModal = function (estimation) {
                _this.estimationDetails(new EstiationDetail(estimation, _this.buildingId, _this.companies, _this.onSave));
                _this.modalOpen(true);
                $("body").addClass("modal-open");
                var modal = $("#estimationModal");
                modal.addClass("show");
                modal.css("display", "block");
            };
            this.closeModal = function () {
                _this.estimationDetails(null);
                _this.modalOpen(false);
                $("body").removeClass("modal-open");
                var modal = $("#estimationModal");
                modal.removeClass("show");
                modal.css("display", "none");
            };
            this.onSave = function (estimation) {
                rest.post("building", _this.buildingId + "/estimation/" + estimation.id, estimation);
                _this.closeModal();
                _this.getEstimations(_this.buildingId)
                    .done(function (data) {
                    return _this.estimations(data);
                });
            };
            this.modalOpen = ko.observable(false);
            this.estimations = ko.observableArray([]);
            this.estimationDetails = ko.observable(null);
            this.companies = companies;
            this.buildingId = buildingId;
            this.getEstimations(buildingId)
                .done(function (data) {
                return _this.estimations(data);
            });
        }
        Estimation.prototype.getEstimations = function (buildingId) {
            return rest.get("building", buildingId + "/estimation");
        };
        Estimation.prototype.dispose = function () {
        };
        return Estimation;
    }());
    exports.Estimation = Estimation;
    var EstiationDetail = (function () {
        function EstiationDetail(base, buildingId, avaiableCompanies, onSave) {
            var _this = this;
            this.companyEditing = ko.observable(false);
            this.reports = ko.observableArray([]);
            this.id = base.id;
            this.buildingId = buildingId;
            this.specNumber = base.specNumber;
            this.estimationId = base.estimationId;
            this.description = new EditableValue(base.description);
            this.unit = new EditableValue(base.unit);
            this.quantity = new EditableValue(base.quantity);
            this.unitPrice = new EditableValue(base.unitPrice);
            this.amount = new EditableValue(base.amount);
            this.avaiableCompany =
                ko.observableArray(avaiableCompanies.map(function (ac) { return ({ value: ac.id, displayValue: ac.name }); }));
            var company = this.avaiableCompany()
                .filter(function (c) { return c.value === base.companyId; })[0];
            this.selctedCompany = ko.observable(company);
            this.onSave = onSave;
            this.getReport()
                .done(function (data) {
                data.forEach(function (d) { return d.date = new Date(d.date).toLocaleDateString(); });
                _this.reports(data);
            });
        }
        EstiationDetail.prototype.getCompanyName = function () {
            if (this.selctedCompany() === undefined || this.selctedCompany() === null)
                return "Company Not Set";
            return this.selctedCompany().displayValue;
        };
        EstiationDetail.prototype.toggleCompany = function () {
            this.companyEditing(!this.companyEditing());
        };
        EstiationDetail.prototype.saveEstimation = function () {
            this.onSave({
                id: this.id,
                estimationId: this.estimationId,
                specNumber: this.specNumber,
                description: this.description.value(),
                unit: this.unit.value(),
                quantity: this.quantity.value(),
                unitPrice: this.unitPrice.value(),
                amount: this.amount.value(),
                companyId: this.selctedCompany().value
            });
        };
        EstiationDetail.prototype.getReport = function () {
            return rest.get("building", this.buildingId + "/estimation/" + this.id + "/reports");
        };
        return EstiationDetail;
    }());
    var EditableValue = (function () {
        function EditableValue(value) {
            this.value = ko.observable(value);
            this.editingMode = ko.observable(false);
        }
        EditableValue.prototype.icon = function () {
            if (this.editingMode())
                return "fa-check";
            return "fa-pencil";
        };
        EditableValue.prototype.toggleMode = function () {
            this.editingMode(!this.editingMode());
        };
        return EditableValue;
    }());
});
//# sourceMappingURL=estimation.js.map
///<amd-module name="buildings/building/report/report"/>
define("buildings/building/report/report", ["require", "exports", "knockout", "utils/communication/rest"], function (require, exports, ko, rest) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Report = (function () {
        function Report(buildingId, reportId) {
            if (reportId === void 0) { reportId = null; }
            var _this = this;
            this.deleteWork = function (estimationId) {
                var deleted = _this.workDone.remove(function (i) { return i.estimationId === estimationId; })[0];
                _this.estimations.push({
                    value: deleted.estimationId,
                    displayValue: deleted.estimationDescription
                });
            };
            this.buildingId = buildingId;
            this.reportId = reportId;
            this.numberOfWorkers = ko.observable(null);
            this.workDone = ko.observableArray([]);
            this.addNew = ko.observable(false);
            this.newWorkEstimate = ko.observable(null);
            this.newWorkQuantity = ko.observable(null);
            this.estimations = ko.observableArray([]);
            this.canEdit = ko.observable(true);
            this.getEstimations().done(function (data) {
                _this.estimations(data.map(function (d) { return ({
                    value: d.id,
                    displayValue: d.description + " (" + d.unit + ")"
                }); }));
                if (reportId !== null)
                    _this.getReport(reportId)
                        .done(function (data) {
                        _this.canEdit(data.canEdit);
                        _this.numberOfWorkers(data.numberOfWorkers);
                        var date = new Date(data.date);
                        $("#report-date").val(date.getMonth() + 1 + "/" + date.getDate() + "/" + date.getFullYear());
                        data.work.forEach(function (w) {
                            var deleted = _this.estimations.remove(function (i) { return i.value === w.estimationId; })[0];
                            _this.workDone.push(new Work(deleted.displayValue, w.estimationId, w.quantity, _this.deleteWork));
                        });
                    });
            });
        }
        Report.prototype.addNewWork = function () {
            this.addNew(true);
        };
        Report.prototype.saveAdding = function () {
            var _this = this;
            this.workDone.push(new Work(this.newWorkEstimate().displayValue, this.newWorkEstimate().value, this.newWorkQuantity(), this.deleteWork));
            this.estimations.remove(function (i) { return i.value === _this.newWorkEstimate().value; });
            this.newWorkEstimate(null);
            this.newWorkQuantity(null);
            this.addNew(false);
        };
        Report.prototype.cancelAdding = function () {
            this.newWorkEstimate(null);
            this.newWorkQuantity(null);
            this.addNew(false);
        };
        Report.prototype.getDto = function () {
            var dateString = $("#report-date").val().split("/");
            return {
                date: new Date(Date.UTC(dateString[2], dateString[0] - 1, dateString[1])),
                numberOfWorkers: this.numberOfWorkers(),
                work: this.workDone().map(function (w) { return w.getDto(); }),
                canEdit: false
            };
        };
        Report.prototype.getEstimations = function () {
            return rest.get("building", this.buildingId + "/estimation");
        };
        Report.prototype.getReport = function (reportId) {
            return rest.get("building", this.buildingId + "/report/" + reportId);
        };
        Report.prototype.dispose = function () {
        };
        return Report;
    }());
    exports.Report = Report;
    var Work = (function () {
        function Work(estimationDescription, estimationId, quantity, deleteWork) {
            this.estimationDescription = estimationDescription;
            this.estimationId = estimationId;
            this.quantity = new EditableValue(quantity);
            this.deleteWork = deleteWork;
        }
        Work.prototype.deleteItem = function () {
            this.deleteWork(this.estimationId);
        };
        Work.prototype.getDto = function () {
            return {
                estimationId: this.estimationId,
                quantity: this.quantity.value()
            };
        };
        return Work;
    }());
    var EditableValue = (function () {
        function EditableValue(value) {
            this.value = ko.observable(value);
            this.editingMode = ko.observable(false);
        }
        EditableValue.prototype.icon = function () {
            if (this.editingMode())
                return "fa-check";
            return "fa-pencil";
        };
        EditableValue.prototype.toggleMode = function () {
            this.editingMode(!this.editingMode());
        };
        return EditableValue;
    }());
});
//# sourceMappingURL=report.js.map
///<amd-module name="buildings/building/reports/reports"
define("buildings/building/reports/reports", ["require", "exports", "knockout", "utils/communication/rest"], function (require, exports, ko, rest) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Reports = (function () {
        function Reports(buildingId) {
            this.types = [
                {
                    value: 1, displayValue: "Entire"
                },
                {
                    value: 2, displayValue: "Custom"
                }
            ];
            this.buildingId = buildingId;
            var defaultType = this.types[0];
            this.type = ko.observable(defaultType);
            this.estimationsReport = ko.observableArray([]);
        }
        Reports.prototype.refresh = function () {
            var _this = this;
            this.getReports().done(function (data) { return _this.estimationsReport(data.map(function (d) { return new EstimationReport(d); })); });
        };
        Reports.prototype.getReports = function () {
            if (this.type().value === 1)
                return rest.post("building", this.buildingId + "/mainReports", {});
            var fromString = $("#reports-date-from").val().split("/");
            var from = new Date(Date.UTC(fromString[2], fromString[0] - 1, fromString[1]));
            var toString = $("#reports-date-to").val().split("/");
            var to = new Date(Date.UTC(toString[2], toString[0] - 1, toString[1]));
            return rest.post("building", this.buildingId + "/mainReports", {
                from: from,
                to: to
            });
        };
        return Reports;
    }());
    exports.Reports = Reports;
    var EstimationReport = (function () {
        function EstimationReport(base) {
            this.estimationId = base.estimationId;
            this.specNumber = base.specNumber;
            this.description = base.description;
            this.unit = base.unit;
            this.quantity = base.quantity;
            this.unitPrice = base.unitPrice;
            this.amount = base.amount;
            this.doneQuantity = base.doneQuantity;
            this.work = base.work;
            this.isOpen = ko.observable(false);
        }
        EstimationReport.prototype.toggle = function () {
            this.isOpen(!this.isOpen());
        };
        EstimationReport.prototype.icon = function () {
            if (this.isOpen())
                return "fa-chevron-down";
            return "fa-chevron-right";
        };
        return EstimationReport;
    }());
});
//# sourceMappingURL=reports.js.map
///<amd-module name="buildings/create/steps/building"/>
define("buildings/create/steps/building", ["require", "exports", "knockout"], function (require, exports, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var BuildingStep = (function () {
        function BuildingStep(name) {
            this.name = ko.observable(name);
            this.active = ko.observable(false);
        }
        BuildingStep.prototype.valid = function () { throw new Error("Not implemented"); };
        BuildingStep.prototype.next = function () {
            return this.nextStep;
        };
        BuildingStep.prototype.back = function () {
            return this.backStep;
        };
        BuildingStep.prototype.activate = function (active) {
            this.active(active);
        };
        BuildingStep.prototype.header = function () { return "Building"; };
        BuildingStep.prototype.setNext = function (next) {
            this.nextStep = next;
        };
        BuildingStep.prototype.setBack = function (back) {
            this.backStep = back;
        };
        return BuildingStep;
    }());
    exports.BuildingStep = BuildingStep;
});
//# sourceMappingURL=building.js.map
///<amd-module name="buildings/create/steps/company"/>
define("buildings/create/steps/company", ["require", "exports", "knockout"], function (require, exports, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var CompanyStep = (function () {
        function CompanyStep(nextStep, company) {
            if (nextStep === void 0) { nextStep = null; }
            if (company === void 0) { company = null; }
            if (company != null) {
                this.id = company.id;
                this.name = ko.observable(company.name);
                this.nip = ko.observable(company.nip);
                this.phoneNumber = ko.observable(company.phoneNumber);
                this.email = ko.observable(company.email);
                this.city = ko.observable(company.city);
                this.postCode = ko.observable(company.postCode);
                this.street = ko.observable(company.street);
                this.placeNumber = ko.observable(company.placeNumber);
                this.nextStep = nextStep;
                this.active = ko.observable(false);
            }
            else {
                this.id = 0;
                this.name = ko.observable(null);
                this.nip = ko.observable(null);
                this.phoneNumber = ko.observable(null);
                this.email = ko.observable(null);
                this.city = ko.observable(null);
                this.postCode = ko.observable(null);
                this.street = ko.observable(null);
                this.placeNumber = ko.observable(null);
                this.nextStep = null;
                this.active = ko.observable(false);
            }
        }
        CompanyStep.prototype.valid = function () { throw new Error("Not implemented"); };
        CompanyStep.prototype.next = function () {
            return this.nextStep;
        };
        CompanyStep.prototype.back = function () {
            return null;
        };
        CompanyStep.prototype.activate = function (active) {
            this.active(active);
        };
        CompanyStep.prototype.header = function () { return "Company"; };
        CompanyStep.prototype.getDto = function () {
            return {
                id: this.id,
                name: this.name(),
                nip: this.nip(),
                phoneNumber: this.phoneNumber(),
                email: this.email(),
                city: this.city(),
                postCode: this.postCode(),
                street: this.street(),
                placeNumber: this.placeNumber()
            };
        };
        return CompanyStep;
    }());
    exports.CompanyStep = CompanyStep;
});
//# sourceMappingURL=company.js.map
///<amd-module name="buildings/create/steps/estimate"/>
define("buildings/create/steps/estimate", ["require", "exports", "knockout"], function (require, exports, ko) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var EstimateStep = (function () {
        function EstimateStep(backStep) {
            this.backStep = backStep;
            this.active = ko.observable(false);
            this.badFile = ko.observable(false);
        }
        EstimateStep.prototype.saveFile = function (_, event) {
            var file = event.target.files[0];
            if (file.name.match(".*.xlsx")) {
                this.file = file;
                this.badFile(false);
            }
            else {
                this.file = null;
                this.badFile(true);
            }
        };
        EstimateStep.prototype.valid = function () {
            return !this.badFile() && this.file !== null;
        };
        EstimateStep.prototype.next = function () {
            return null;
        };
        EstimateStep.prototype.back = function () {
            return this.backStep;
        };
        EstimateStep.prototype.activate = function (active) {
            this.active(active);
        };
        EstimateStep.prototype.header = function () { return "Estimate"; };
        EstimateStep.prototype.getDto = function () {
            var fdata = new FormData();
            fdata.append(this.file.name, this.file);
            return fdata;
        };
        return EstimateStep;
    }());
    exports.EstimateStep = EstimateStep;
});
//# sourceMappingURL=estimate.js.map
///<amd-module name="buildings/building/companies/subContractor/subContractor"/>
define("buildings/building/companies/subContractor/subContractor", ["require", "exports", "buildings/create/steps/company", "knockout", "utils/communication/rest", "utils/navigator"], function (require, exports, company_1, ko, rest, navigator) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var SubContractor = (function () {
        function SubContractor(buildingId) {
            this.buildingId = buildingId;
            this.company = ko.observable(new company_1.CompanyStep());
            this.modalOpen = ko.observable(false);
            this.openModal();
        }
        SubContractor.prototype.saveCompany = function () {
            var _this = this;
            var dto = this.company().getDto();
            rest.post("company", "", {
                name: dto.name,
                nip: dto.nip,
                phoneNumber: dto.phoneNumber,
                email: dto.email,
                city: dto.city,
                postCode: dto.postCode,
                street: dto.street,
                placeNumber: dto.placeNumber,
                buildingId: this.buildingId
            }).done(function (data) {
                _this.closeModal();
                navigator.navigate("user/register/" + data);
            });
        };
        SubContractor.prototype.closeModal = function () {
            this.modalOpen(false);
            $("body").removeClass("modal-open");
            var modal = $("#addSubContractor");
            modal.removeClass("show");
            modal.css("display", "none");
        };
        SubContractor.prototype.openModal = function () {
            this.modalOpen(true);
            $("body").addClass("modal-open");
        };
        SubContractor.prototype.dispose = function () {
        };
        return SubContractor;
    }());
    exports.SubContractor = SubContractor;
});
//# sourceMappingURL=subContractor.js.map